<svg width="1100" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #2c3e50; }
      .label { font-family: Arial, sans-serif; font-size: 11px; fill: #2c3e50; }
      .small-label { font-family: Arial, sans-serif; font-size: 10px; fill: #2c3e50; }
      .start-end { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .activity { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .decision { fill: #f39c12; stroke: #e67e22; stroke-width: 2; }
      .process { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .cache { fill: #e67e22; stroke: #d35400; stroke-width: 2; }
      .export { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .arrow { stroke: #2c3e50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .parallel { stroke: #2c3e50; stroke-width: 3; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="550" y="30" text-anchor="middle" class="title">Activity Diagram: Generate Statistik Real-time</text>
  
  <!-- Start -->
  <circle cx="550" cy="70" r="15" class="start-end"/>
  <text x="550" y="75" text-anchor="middle" class="label" fill="white">Start</text>
  
  <!-- Pilih Jenis Statistik -->
  <rect x="470" y="110" width="160" height="40" rx="20" class="activity"/>
  <text x="550" y="135" text-anchor="middle" class="label" fill="white">Pilih Jenis Statistik</text>
  
  <!-- Pilih Periode -->
  <rect x="470" y="180" width="160" height="40" rx="20" class="activity"/>
  <text x="550" y="200" text-anchor="middle" class="label" fill="white">Pilih Periode</text>
  <text x="550" y="215" text-anchor="middle" class="small-label" fill="white">(Bulan/Kuartal/Tahun)</text>
  
  <!-- Cek Cache -->
  <rect x="470" y="250" width="160" height="40" rx="20" class="process"/>
  <text x="550" y="275" text-anchor="middle" class="label" fill="white">Cek Cache Statistik</text>
  
  <!-- Decision: Cache Tersedia? -->
  <polygon points="550,320 600,350 550,380 500,350" class="decision"/>
  <text x="550" y="350" text-anchor="middle" class="label">Cache</text>
  <text x="550" y="365" text-anchor="middle" class="label">Tersedia?</text>
  
  <!-- Cache Path -->
  <rect x="250" y="330" width="160" height="40" rx="20" class="cache"/>
  <text x="330" y="355" text-anchor="middle" class="label" fill="white">Ambil dari Cache</text>
  
  <!-- Real-time Path -->
  <rect x="690" y="330" width="160" height="40" rx="20" class="process"/>
  <text x="770" y="350" text-anchor="middle" class="label" fill="white">Hitung Real-time</text>
  <text x="770" y="365" text-anchor="middle" class="small-label" fill="white">(Query Database)</text>
  
  <!-- Parallel Processing for Real-time -->
  <line x1="770" y1="380" x2="770" y2="400" class="parallel"/>
  <line x1="720" y1="400" x2="820" y2="400" class="parallel"/>
  
  <!-- HT Statistics -->
  <rect x="650" y="420" width="120" height="35" rx="15" class="process"/>
  <text x="710" y="440" text-anchor="middle" class="small-label" fill="white">Hitung HT Stats</text>
  <text x="710" y="450" text-anchor="middle" class="small-label" fill="white">(Terkontrol/Total)</text>
  
  <!-- DM Statistics -->
  <rect x="780" y="420" width="120" height="35" rx="15" class="process"/>
  <text x="840" y="440" text-anchor="middle" class="small-label" fill="white">Hitung DM Stats</text>
  <text x="840" y="450" text-anchor="middle" class="small-label" fill="white">(HbA1c/GDP)</text>
  
  <!-- Merge Results -->
  <line x1="720" y1="470" x2="820" y2="470" class="parallel"/>
  <line x1="770" y1="470" x2="770" y2="490" class="parallel"/>
  
  <!-- Update Cache -->
  <rect x="690" y="500" width="160" height="40" rx="20" class="cache"/>
  <text x="770" y="525" text-anchor="middle" class="label" fill="white">Update Cache</text>
  
  <!-- Format Data -->
  <rect x="470" y="570" width="160" height="40" rx="20" class="process"/>
  <text x="550" y="590" text-anchor="middle" class="label" fill="white">Format Data</text>
  <text x="550" y="605" text-anchor="middle" class="small-label" fill="white">(JSON Response)</text>
  
  <!-- Tampilkan Statistik -->
  <rect x="470" y="640" width="160" height="40" rx="20" class="activity"/>
  <text x="550" y="665" text-anchor="middle" class="label" fill="white">Tampilkan Statistik</text>
  
  <!-- Decision: Export Request? -->
  <polygon points="550,710 600,740 550,770 500,740" class="decision"/>
  <text x="550" y="740" text-anchor="middle" class="label">Export</text>
  <text x="550" y="755" text-anchor="middle" class="label">Request?</text>
  
  <!-- Export Path -->
  <rect x="250" y="720" width="160" height="40" rx="20" class="export"/>
  <text x="330" y="745" text-anchor="middle" class="label" fill="white">Generate Export</text>
  
  <!-- Download File -->
  <rect x="250" y="790" width="160" height="40" rx="20" class="export"/>
  <text x="330" y="815" text-anchor="middle" class="label" fill="white">Download File</text>
  
  <!-- End -->
  <circle cx="550" cy="850" r="15" class="start-end"/>
  <text x="550" y="855" text-anchor="middle" class="label" fill="white">End</text>
  
  <!-- Arrows -->
  <!-- Start to Pilih Jenis -->
  <line x1="550" y1="85" x2="550" y2="110" class="arrow"/>
  
  <!-- Pilih Jenis to Pilih Periode -->
  <line x1="550" y1="150" x2="550" y2="180" class="arrow"/>
  
  <!-- Pilih Periode to Cek Cache -->
  <line x1="550" y1="220" x2="550" y2="250" class="arrow"/>
  
  <!-- Cek Cache to Decision -->
  <line x1="550" y1="290" x2="550" y2="320" class="arrow"/>
  
  <!-- Decision to Cache (Yes) -->
  <line x1="500" y1="350" x2="410" y2="350" class="arrow"/>
  <text x="455" y="345" class="label">Yes</text>
  
  <!-- Decision to Real-time (No) -->
  <line x1="600" y1="350" x2="690" y2="350" class="arrow"/>
  <text x="645" y="345" class="label">No</text>
  
  <!-- Real-time to parallel processing -->
  <line x1="770" y1="370" x2="770" y2="420" class="arrow"/>
  
  <!-- Parallel to Update Cache -->
  <line x1="770" y1="490" x2="770" y2="500" class="arrow"/>
  
  <!-- Cache to Format -->
  <line x1="330" y1="370" x2="470" y2="590" class="arrow"/>
  
  <!-- Update Cache to Format -->
  <line x1="770" y1="540" x2="630" y2="590" class="arrow"/>
  
  <!-- Format to Tampilkan -->
  <line x1="550" y1="610" x2="550" y2="640" class="arrow"/>
  
  <!-- Tampilkan to Export Decision -->
  <line x1="550" y1="680" x2="550" y2="710" class="arrow"/>
  
  <!-- Export Decision to Generate (Yes) -->
  <line x1="500" y1="740" x2="410" y2="740" class="arrow"/>
  <text x="455" y="735" class="label">Yes</text>
  
  <!-- Generate to Download -->
  <line x1="330" y1="760" x2="330" y2="790" class="arrow"/>
  
  <!-- Download to End -->
  <line x1="330" y1="830" x2="535" y2="850" class="arrow"/>
  
  <!-- Export Decision to End (No) -->
  <line x1="550" y1="770" x2="550" y2="835" class="arrow"/>
  <text x="560" y="800" class="label">No</text>
  
  <!-- Performance Info -->
  <rect x="50" y="50" width="300" height="200" fill="#e8f6f3" stroke="#27ae60" stroke-width="1"/>
  <text x="60" y="70" class="label" font-weight="bold">Performance Optimization:</text>
  <text x="60" y="90" class="small-label">• Cache statistik bulanan</text>
  <text x="60" y="105" class="small-label">• Parallel processing HT & DM</text>
  <text x="60" y="120" class="small-label">• Database indexing optimized</text>
  <text x="60" y="135" class="small-label">• Real-time calculation fallback</text>
  <text x="60" y="150" class="small-label">• Export format: PDF, Excel</text>
  <text x="60" y="165" class="small-label">• Role-based data filtering</text>
  <text x="60" y="180" class="small-label">• Monthly cache auto-update</text>
  <text x="60" y="195" class="small-label">• Breakdown: Total, Terkontrol, %</text>
  <text x="60" y="210" class="small-label">• Target progress tracking</text>
  <text x="60" y="225" class="small-label">• Multi-period comparison</text>
  
  <!-- Cache Strategy -->
  <rect x="750" y="50" width="300" height="150" fill="#fef9e7" stroke="#f39c12" stroke-width="1"/>
  <text x="760" y="70" class="label" font-weight="bold">Cache Strategy:</text>
  <text x="760" y="90" class="small-label">• Cache Key: puskesmas_id + disease + month</text>
  <text x="760" y="105" class="small-label">• TTL: 24 hours (auto-refresh)</text>
  <text x="760" y="120" class="small-label">• Invalidation: On new examination</text>
  <text x="760" y="135" class="small-label">• Fallback: Real-time calculation</text>
  <text x="760" y="150" class="small-label">• Storage: Database table cache</text>
  <text x="760" y="165" class="small-label">• Compression: JSON format</text>
  <text x="760" y="180" class="small-label">• Warming: Background job</text>
  
  <!-- Legend -->
  <rect x="50" y="600" width="200" height="190" fill="none" stroke="#bdc3c7" stroke-width="1"/>
  <text x="60" y="620" class="label" font-weight="bold">Legend:</text>
  
  <circle cx="70" cy="635" r="8" class="start-end"/>
  <text x="85" y="640" class="label">Start/End</text>
  
  <rect x="62" y="650" width="16" height="10" rx="5" class="activity"/>
  <text x="85" y="660" class="label">User Activity</text>
  
  <rect x="62" y="670" width="16" height="10" rx="5" class="process"/>
  <text x="85" y="680" class="label">System Process</text>
  
  <rect x="62" y="690" width="16" height="10" rx="5" class="cache"/>
  <text x="85" y="700" class="label">Cache Operation</text>
  
  <rect x="62" y="710" width="16" height="10" rx="5" class="export"/>
  <text x="85" y="720" class="label">Export Process</text>
  
  <polygon points="70,730 78,738 70,746 62,738" class="decision"/>
  <text x="85" y="740" class="label">Decision</text>
  
  <line x1="62" y1="755" x2="78" y2="755" class="parallel"/>
  <text x="85" y="760" class="label">Parallel Process</text>
</svg>