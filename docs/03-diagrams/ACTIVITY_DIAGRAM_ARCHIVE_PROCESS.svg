<svg width="900" height="650" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #2c3e50; }
      .label { font-family: Arial, sans-serif; font-size: 11px; fill: #2c3e50; }
      .small-label { font-family: Arial, sans-serif; font-size: 10px; fill: #2c3e50; }
      .start-end { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .activity { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .system { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .database { fill: #e67e22; stroke: #d35400; stroke-width: 2; }
      .notification { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .arrow { stroke: #2c3e50; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .parallel { stroke: #2c3e50; stroke-width: 3; fill: none; }
      .trigger { fill: #f1c40f; stroke: #f39c12; stroke-width: 2; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" class="title">Activity Diagram: Proses Arsip Otomatis (New Year Setup)</text>
  
  <!-- Start: System Trigger -->
  <rect x="370" y="60" width="160" height="40" rx="20" class="trigger"/>
  <text x="450" y="80" text-anchor="middle" class="label">System Trigger</text>
  <text x="450" y="95" text-anchor="middle" class="small-label">(1 Januari 00:00)</text>
  
  <!-- Identifikasi Data Tahun Lalu -->
  <rect x="370" y="130" width="160" height="40" rx="20" class="system"/>
  <text x="450" y="150" text-anchor="middle" class="label" fill="white">Identifikasi Data</text>
  <text x="450" y="165" text-anchor="middle" class="small-label" fill="white">Tahun Sebelumnya</text>
  
  <!-- Parallel Processing -->
  <line x1="450" y1="180" x2="450" y2="200" class="parallel"/>
  <line x1="300" y1="200" x2="600" y2="200" class="parallel"/>
  
  <!-- Archive HT Examinations -->
  <rect x="220" y="220" width="160" height="40" rx="20" class="database"/>
  <text x="300" y="240" text-anchor="middle" class="label" fill="white">Update Flag Archive</text>
  <text x="300" y="255" text-anchor="middle" class="small-label" fill="white">HT Examinations</text>
  
  <!-- Archive DM Examinations -->
  <rect x="520" y="220" width="160" height="40" rx="20" class="database"/>
  <text x="600" y="240" text-anchor="middle" class="label" fill="white">Update Flag Archive</text>
  <text x="600" y="255" text-anchor="middle" class="small-label" fill="white">DM Examinations</text>
  
  <!-- Merge Parallel -->
  <line x1="300" y1="270" x2="600" y2="270" class="parallel"/>
  <line x1="450" y1="270" x2="450" y2="290" class="parallel"/>
  
  <!-- Hitung Total Archived -->
  <rect x="370" y="300" width="160" height="40" rx="20" class="system"/>
  <text x="450" y="320" text-anchor="middle" class="label" fill="white">Hitung Total</text>
  <text x="450" y="335" text-anchor="middle" class="small-label" fill="white">Data yang Diarsipkan</text>
  
  <!-- Generate Report -->
  <rect x="370" y="370" width="160" height="40" rx="20" class="system"/>
  <text x="450" y="390" text-anchor="middle" class="label" fill="white">Generate Report</text>
  <text x="450" y="405" text-anchor="middle" class="small-label" fill="white">Archive Summary</text>
  
  <!-- Send Notification -->
  <rect x="370" y="440" width="160" height="40" rx="20" class="notification"/>
  <text x="450" y="460" text-anchor="middle" class="label" fill="white">Send Notification</text>
  <text x="450" y="475" text-anchor="middle" class="small-label" fill="white">ke Admin</text>
  
  <!-- Log Archive Process -->
  <rect x="370" y="510" width="160" height="40" rx="20" class="system"/>
  <text x="450" y="530" text-anchor="middle" class="label" fill="white">Log Archive Process</text>
  <text x="450" y="545" text-anchor="middle" class="small-label" fill="white">Audit Trail</text>
  
  <!-- End -->
  <circle cx="450" cy="590" r="15" class="start-end"/>
  <text x="450" y="595" text-anchor="middle" class="label" fill="white">End</text>
  
  <!-- Arrows -->
  <!-- Trigger to Identifikasi -->
  <line x1="450" y1="100" x2="450" y2="130" class="arrow"/>
  
  <!-- Identifikasi to Parallel -->
  <line x1="450" y1="170" x2="450" y2="220" class="arrow"/>
  
  <!-- Parallel to Archive processes -->
  <line x1="300" y1="200" x2="300" y2="220" class="arrow"/>
  <line x1="600" y1="200" x2="600" y2="220" class="arrow"/>
  
  <!-- Archive processes to merge -->
  <line x1="300" y1="260" x2="300" y2="270" class="arrow"/>
  <line x1="600" y1="260" x2="600" y2="270" class="arrow"/>
  
  <!-- Merge to Hitung Total -->
  <line x1="450" y1="290" x2="450" y2="300" class="arrow"/>
  
  <!-- Hitung Total to Generate Report -->
  <line x1="450" y1="340" x2="450" y2="370" class="arrow"/>
  
  <!-- Generate Report to Send Notification -->
  <line x1="450" y1="410" x2="450" y2="440" class="arrow"/>
  
  <!-- Send Notification to Log -->
  <line x1="450" y1="480" x2="450" y2="510" class="arrow"/>
  
  <!-- Log to End -->
  <line x1="450" y1="550" x2="450" y2="575" class="arrow"/>
  
  <!-- Archive Details -->
  <rect x="50" y="50" width="280" height="200" fill="#e8f5e8" stroke="#27ae60" stroke-width="1"/>
  <text x="60" y="70" class="label" font-weight="bold">Archive Process Details:</text>
  <text x="60" y="90" class="small-label">• Trigger: Laravel Scheduler (Cron)</text>
  <text x="60" y="105" class="small-label">• Schedule: 0 0 1 1 * (1 Jan 00:00)</text>
  <text x="60" y="120" class="small-label">• Target: Data tahun sebelumnya</text>
  <text x="60" y="135" class="small-label">• Action: Set is_archived = true</text>
  <text x="60" y="150" class="small-label">• No physical data deletion</text>
  <text x="60" y="165" class="small-label">• Archived data still accessible</text>
  <text x="60" y="180" class="small-label">• Performance: Bulk update query</text>
  <text x="60" y="195" class="small-label">• Rollback: Manual admin action</text>
  <text x="60" y="210" class="small-label">• Notification: Email + Dashboard</text>
  <text x="60" y="225" class="small-label">• Report: PDF summary generated</text>
  
  <!-- Business Rules -->
  <rect x="650" y="50" width="200" height="180" fill="#fef9e7" stroke="#f39c12" stroke-width="1"/>
  <text x="660" y="70" class="label" font-weight="bold">Business Rules:</text>
  <text x="660" y="90" class="small-label">• Archive annually only</text>
  <text x="660" y="105" class="small-label">• Previous year data only</text>
  <text x="660" y="120" class="small-label">• Both HT &amp; DM together</text>
  <text x="660" y="135" class="small-label">• Maintain data integrity</text>
  <text x="660" y="150" class="small-label">• Update statistics cache</text>
  <text x="660" y="165" class="small-label">• Generate audit log</text>
  <text x="660" y="180" class="small-label">• Admin notification required</text>
  <text x="660" y="195" class="small-label">• Backup before archive</text>
  <text x="660" y="210" class="small-label">• Performance monitoring</text>
  
  <!-- SQL Operations -->
  <rect x="50" y="280" width="280" height="120" fill="#e8f4fd" stroke="#3498db" stroke-width="1"/>
  <text x="60" y="300" class="label" font-weight="bold">SQL Operations:</text>
  <text x="60" y="320" class="small-label">HT Archive Query:</text>
  <text x="60" y="335" class="small-label">UPDATE ht_examinations</text>
  <text x="60" y="350" class="small-label">SET is_archived = true</text>
  <text x="60" y="365" class="small-label">WHERE year = {last_year}</text>
  <text x="60" y="380" class="small-label">AND is_archived = false</text>
  
  <!-- Legend -->
  <rect x="650" y="280" width="200" height="150" fill="none" stroke="#bdc3c7" stroke-width="1"/>
  <text x="660" y="300" class="label" font-weight="bold">Legend:</text>
  
  <rect x="662" y="310" width="16" height="10" rx="5" class="trigger"/>
  <text x="685" y="320" class="label">System Trigger</text>
  
  <rect x="662" y="330" width="16" height="10" rx="5" class="system"/>
  <text x="685" y="340" class="label">System Process</text>
  
  <rect x="662" y="350" width="16" height="10" rx="5" class="database"/>
  <text x="685" y="360" class="label">Database Operation</text>
  
  <rect x="662" y="370" width="16" height="10" rx="5" class="notification"/>
  <text x="685" y="380" class="label">Notification</text>
  
  <line x1="662" y1="395" x2="678" y2="395" class="parallel"/>
  <text x="685" y="400" class="label">Parallel Process</text>
  
  <circle cx="670" cy="415" r="8" class="start-end"/>
  <text x="685" y="420" class="label">Start/End</text>
</svg>